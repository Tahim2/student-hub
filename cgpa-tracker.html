<!DOCTYPE html>
<html lang="en" class="dark:bg-gray-900">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CGPA Tracker - UniHub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#1E40AF',
                        secondary: '#F59E0B',
                        accent: '#10B981',
                    },
                    animation: {
                        'fade-in': 'fadeIn 1s ease-in-out',
                        'slide-up': 'slideUp 0.5s ease-out',
                        'bounce-in': 'bounceIn 0.6s ease-out',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        bounceIn: { '0%': { transform: 'scale(0.3)', opacity: '0' }, '50%': { transform: 'scale(1.05)' }, '70%': { transform: 'scale(0.9)' }, '100%': { transform: 'scale(1)', opacity: '1' } },
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 font-sans flex flex-col min-h-screen transition-colors duration-300">
    <!-- Enhanced Responsive Navbar -->
    <nav class="bg-primary dark:bg-gray-800 text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <a href="index.html" class="text-2xl font-bold tracking-tight">UniHub</a>
            <div class="hidden md:flex space-x-6 items-center">
                <a href="index.html" class="hover:text-secondary transition duration-300">Home</a>
                <a href="faculty-reviews.html" class="hover:text-secondary transition duration-300">Faculty Reviews</a>
                <a href="resource-hub.html" class="hover:text-secondary transition duration-300">Resource Hub</a>
                <a href="cgpa-tracker.html" class="text-secondary font-medium border-b-2 border-secondary">CGPA Tracker</a>
                <a href="dashboard.html" class="hover:text-secondary transition duration-300">Dashboard</a>
                
                <!-- Settings Dropdown -->
                <div class="relative">
                    <button id="settings-toggle" class="p-2 rounded-full hover:bg-secondary transition">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                    </button>
                    <div id="settings-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-600 z-50">
                        <div class="py-2">
                            <a href="user-profile.html" class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-200 hover:bg-blue-50 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition">
                                <svg class="w-4 h-4 mr-3 text-gray-500 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                                Profile Settings
                            </a>
                            <button id="theme-toggle-dropdown" class="flex items-center w-full px-4 py-2 text-gray-700 dark:text-gray-200 hover:bg-blue-50 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition text-left">
                                <svg class="w-4 h-4 mr-3 text-gray-500 dark:text-gray-400 dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                                </svg>
                                <svg class="w-4 h-4 mr-3 text-gray-500 dark:text-gray-400 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                                </svg>
                                <span class="dark:hidden">Dark Mode</span>
                                <span class="hidden dark:block">Light Mode</span>
                            </button>
                            <a href="#" class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-200 hover:bg-blue-50 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition">
                                <svg class="w-4 h-4 mr-3 text-gray-500 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM4 12v5h5l-5-5zM4 7V2l5 5H4z"></path>
                                </svg>
                                Notifications
                            </a>
                            <a href="#" class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-200 hover:bg-blue-50 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition">
                                <svg class="w-4 h-4 mr-3 text-gray-500 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                </svg>
                                Privacy
                            </a>
                            <hr class="my-2 border-gray-200 dark:border-gray-600">
                            <button onclick="logout()" class="flex items-center w-full px-4 py-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 hover:text-red-700 dark:hover:text-red-300 transition text-left">
                                <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                </svg>
                                Logout
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <button class="md:hidden focus:outline-none" onclick="document.getElementById('mobile-menu').classList.toggle('hidden')">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                </svg>
            </button>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-primary dark:bg-gray-800 transition-all duration-300 ease-in-out">
            <a href="index.html" class="block px-4 py-2 hover:bg-secondary hover:text-white transition duration-300">Home</a>
            <a href="faculty-reviews.html" class="block px-4 py-2 hover:bg-secondary hover:text-white transition duration-300">Faculty Reviews</a>
            <a href="resource-hub.html" class="block px-4 py-2 hover:bg-secondary hover:text-white transition duration-300">Resource Hub</a>
            <a href="cgpa-tracker.html" class="block px-4 py-2 bg-secondary text-white">CGPA Tracker</a>
            <a href="dashboard.html" class="block px-4 py-2 hover:bg-secondary hover:text-white transition duration-300">Dashboard</a>
            
            <!-- Mobile Settings Section -->
            <div class="border-t border-gray-600 mt-2 pt-2">
                <p class="px-4 py-1 text-sm text-gray-300 uppercase tracking-wide">Settings</p>
                <a href="user-profile.html" class="block px-4 py-2 hover:bg-secondary hover:text-white transition duration-300">Profile Settings</a>
                <button id="mobile-theme-toggle" class="block px-4 py-2 w-full text-left hover:bg-secondary hover:text-white transition duration-300">
                    <span class="dark:hidden">üåô Dark Mode</span>
                    <span class="hidden dark:block">‚òÄÔ∏è Light Mode</span>
                </button>
                <a href="#" class="block px-4 py-2 hover:bg-secondary hover:text-white transition duration-300">üîî Notifications</a>
                <a href="#" class="block px-4 py-2 hover:bg-secondary hover:text-white transition duration-300">üîí Privacy</a>
                <button onclick="logout()" class="block px-4 py-2 w-full text-left text-red-400 hover:bg-red-700 hover:text-white transition duration-300">üö™ Logout</button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow py-8 bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800">
        <div class="container mx-auto px-4 max-w-7xl">
            <!-- Header Section -->
            <div class="text-center mb-12 animate-fade-in">
                <h1 class="text-5xl font-extrabold text-primary dark:text-white mb-4">
                    Academic Progress Tracker
                </h1>
                <p class="text-xl text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">
                    Monitor your academic journey with comprehensive CGPA tracking and progress visualization
                </p>
            </div>

            <!-- Quick Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 text-center transform hover:scale-105 transition-transform duration-300">
                    <div class="text-3xl font-bold text-primary dark:text-secondary mb-2" id="current-cgpa-display">0.00</div>
                    <div class="text-gray-600 dark:text-gray-400">Current CGPA</div>
                </div>
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 text-center transform hover:scale-105 transition-transform duration-300">
                    <div class="text-3xl font-bold text-accent mb-2" id="total-credits-display">0</div>
                    <div class="text-gray-600 dark:text-gray-400">Total Credits</div>
                </div>
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 text-center transform hover:scale-105 transition-transform duration-300">
                    <div class="text-3xl font-bold text-secondary mb-2" id="semesters-completed-display">0</div>
                    <div class="text-gray-600 dark:text-gray-400">Semesters</div>
                </div>
            </div>

            <!-- Main Content Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Left Column: Input Forms -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Student Information Card -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 animate-slide-up">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-6 flex items-center">
                            <svg class="w-6 h-6 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            Student Information
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="student-id" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Student ID</label>
                                <input type="text" id="student-id" class="w-full p-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:border-primary transition dark:bg-gray-700 dark:text-white" placeholder="e.g., 221-15-4757" pattern="\\d{3}-\\d{2}-\\d{4}" title="Format: XXX-XX-XXXX" required>
                                <div class="text-red-500 text-sm mt-1 hidden" id="student-id-error">Please enter a valid Student ID</div>
                            </div>
                            <div>
                                <label for="student-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Full Name</label>
                                <input type="text" id="student-name" class="w-full p-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:border-primary transition dark:bg-gray-700 dark:text-white" placeholder="Enter your full name" required>
                            </div>
                            <div>
                                <label for="batch" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Batch</label>
                                <input type="text" id="batch" class="w-full p-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:border-primary transition dark:bg-gray-700 dark:text-white" placeholder="e.g., 61" pattern="\\d{2}" title="Format: Two digits" required>
                            </div>
                            <div>
                                <label for="department" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Department</label>
                                <select id="department" class="w-full p-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:border-primary transition dark:bg-gray-700 dark:text-white" required>
                                    <option value="">Select Department</option>
                                    <option value="CSE">Computer Science & Engineering</option>
                                    <option value="EEE">Electrical & Electronic Engineering</option>
                                    <option value="ME">Mechanical Engineering</option>
                                    <option value="CE">Civil Engineering</option>
                                    <option value="BBA">Business Administration</option>
                                    <option value="ENG">English</option>
                                    <option value="LAW">Law</option>
                                    <option value="PHAR">Pharmacy</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Semester Management Card -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 animate-slide-up">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-800 dark:text-white flex items-center">
                                <svg class="w-6 h-6 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                Semester Management
                            </h2>
                            <button id="add-semester-btn" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-secondary transition transform hover:scale-105 flex items-center">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                </svg>
                                Add Semester
                            </button>
                        </div>
                        <div id="semesters-container" class="space-y-4">
                            <!-- Semesters will be added here dynamically -->
                        </div>
                    </div>

                    <!-- Target Planning Card -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 animate-slide-up">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-6 flex items-center">
                            <svg class="w-6 h-6 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                            Target Planning
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="target-cgpa" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Target CGPA</label>
                                <input type="number" id="target-cgpa" step="0.01" min="0" max="4" value="3.75" class="w-full p-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:border-primary transition dark:bg-gray-700 dark:text-white">
                            </div>
                            <div>
                                <label for="remaining-semesters" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Remaining Semesters</label>
                                <input type="number" id="remaining-semesters" min="1" value="3" class="w-full p-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:border-primary transition dark:bg-gray-700 dark:text-white">
                            </div>
                        </div>
                        <button id="calculate-btn" class="w-full mt-4 bg-gradient-to-r from-primary to-secondary text-white px-6 py-3 rounded-lg font-semibold hover:from-secondary hover:to-primary transition transform hover:scale-105 shadow-lg">
                            Calculate Progress & Targets
                        </button>
                    </div>
                </div>

                <!-- Right Column: Results & Visualization -->
                <div class="space-y-6">
                    <!-- Results Card -->
                    <div id="results-card" class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 animate-slide-up hidden">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-6 flex items-center">
                            <svg class="w-6 h-6 mr-2 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                            Academic Results
                        </h2>
                        <div id="results-content" class="space-y-4">
                            <!-- Results will be populated here -->
                        </div>
                    </div>

                    <!-- Progress Visualization -->
                    <div id="chart-card" class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 animate-slide-up hidden">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-6 flex items-center">
                            <svg class="w-6 h-6 mr-2 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path>
                            </svg>
                            Progress Visualization
                        </h2>
                        <div class="h-64">
                            <canvas id="cgpa-chart"></canvas>
                        </div>
                    </div>

                    <!-- Semester Summary -->
                    <div id="semester-summary" class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 animate-slide-up hidden">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-6 flex items-center">
                            <svg class="w-6 h-6 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                            </svg>
                            Semester Summary
                        </h2>
                        <div id="semester-summary-content" class="space-y-3">
                            <!-- Semester summaries will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-primary dark:bg-gray-800 text-white py-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col items-center">
                <h3 class="text-xl font-bold mb-2 tracking-tight">UniHub</h3>
                <p class="text-sm mb-4">Empowering your academic journey</p>
                <div class="flex space-x-6 text-sm">
                    <a href="#" class="hover:text-secondary transition">Privacy Policy</a>
                    <a href="#" class="hover:text-secondary transition">Terms of Service</a>
                    <a href="#" class="hover:text-secondary transition">Contact Us</a>
                </div>
            </div>
            <div class="mt-6 text-center text-sm">
                <p>¬© 2025 UniHub. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Enhanced Application State Management
        class CGPATracker {
            constructor() {
                this.semesters = [];
                this.studentInfo = {};
                this.gradePoints = {
                    'A+': 4.0, 'A': 4.0, 'A-': 3.7,
                    'B+': 3.3, 'B': 3.0, 'B-': 2.7,
                    'C+': 2.3, 'C': 2.0, 'C-': 1.7,
                    'D+': 1.3, 'D': 1.0, 'F': 0.0
                };
                this.semesterCount = 0;
                this.chart = null;
                this.init();
            }

            init() {
                this.loadFromStorage();
                this.setupEventListeners();
                this.setupTheme();
                this.checkAuthentication();
                this.addFirstSemester();
            }

            checkAuthentication() {
                // Check if user is logged in, if not create a demo user for testing
                if (!localStorage.getItem('currentUser')) {
                    // Create a demo user session for testing
                    const demoUser = {
                        id: 'demo-user',
                        name: 'Demo Student',
                        email: 'demo@student.hub',
                        loginTime: new Date().toISOString()
                    };
                    localStorage.setItem('currentUser', JSON.stringify(demoUser));
                }
            }

            setupTheme() {
                const currentTheme = localStorage.getItem('theme') || 'light';
                document.documentElement.classList.toggle('dark', currentTheme === 'dark');

                // Theme toggle handlers
                const toggleTheme = () => {
                    document.documentElement.classList.toggle('dark');
                    const isDark = document.documentElement.classList.contains('dark');
                    localStorage.setItem('theme', isDark ? 'dark' : 'light');
                };

                document.getElementById('theme-toggle-dropdown')?.addEventListener('click', toggleTheme);
                document.getElementById('mobile-theme-toggle')?.addEventListener('click', toggleTheme);

                // Settings dropdown
                const settingsToggle = document.getElementById('settings-toggle');
                const settingsDropdown = document.getElementById('settings-dropdown');
                
                settingsToggle?.addEventListener('click', () => {
                    settingsDropdown.classList.toggle('hidden');
                });

                document.addEventListener('click', (e) => {
                    if (!settingsToggle?.contains(e.target) && !settingsDropdown?.contains(e.target)) {
                        settingsDropdown?.classList.add('hidden');
                    }
                });
            }

            setupEventListeners() {
                document.getElementById('add-semester-btn').addEventListener('click', () => this.addSemester());
                document.getElementById('calculate-btn').addEventListener('click', () => this.calculateResults());
                
                // Auto-save on input changes
                document.addEventListener('input', (e) => {
                    if (e.target.matches('#student-id, #student-name, #batch, #department, #target-cgpa, #remaining-semesters')) {
                        this.saveToStorage();
                    }
                });

                // Form validation
                document.getElementById('student-id').addEventListener('blur', this.validateStudentId);
            }

            validateStudentId() {
                const studentId = document.getElementById('student-id').value;
                const pattern = /^\d{3}-\d{2}-\d{4}$/;
                const errorDiv = document.getElementById('student-id-error');
                
                if (studentId && !pattern.test(studentId)) {
                    errorDiv.classList.remove('hidden');
                    document.getElementById('student-id').classList.add('border-red-500');
                } else {
                    errorDiv.classList.add('hidden');
                    document.getElementById('student-id').classList.remove('border-red-500');
                }
            }

            addFirstSemester() {
                if (this.semesters.length === 0) {
                    this.addSemester();
                }
            }

            addSemester() {
                this.semesterCount++;
                const semester = {
                    id: this.semesterCount,
                    courses: []
                };
                this.semesters.push(semester);
                this.renderSemester(semester);
                this.saveToStorage();
            }

            renderSemester(semester) {
                const container = document.getElementById('semesters-container');
                const semesterDiv = document.createElement('div');
                semesterDiv.className = 'semester-card bg-gray-50 dark:bg-gray-700 rounded-lg p-4 animate-bounce-in';
                semesterDiv.id = `semester-${semester.id}`;
                
                semesterDiv.innerHTML = `
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Semester ${semester.id}</h3>
                        <div class="flex space-x-2">
                            <button onclick="cgpaTracker.addCourse(${semester.id})" class="bg-accent text-white px-3 py-1 rounded-lg hover:bg-green-600 transition text-sm">
                                + Course
                            </button>
                            <button onclick="cgpaTracker.removeSemester(${semester.id})" class="bg-red-500 text-white px-3 py-1 rounded-lg hover:bg-red-600 transition text-sm">
                                Remove
                            </button>
                        </div>
                    </div>
                    <div id="courses-${semester.id}" class="space-y-2">
                        <!-- Courses will be added here -->
                    </div>
                    <div class="mt-3 text-sm text-gray-600 dark:text-gray-400">
                        <span id="semester-gpa-${semester.id}">GPA: 0.00</span> |
                        <span id="semester-credits-${semester.id}">Credits: 0</span>
                    </div>
                `;
                
                container.appendChild(semesterDiv);
                this.addCourse(semester.id); // Add first course automatically
            }

            addCourse(semesterId) {
                const semester = this.semesters.find(s => s.id === semesterId);
                if (!semester) return;

                const courseId = Date.now();
                const course = {
                    id: courseId,
                    name: '',
                    code: '',
                    credits: 3,
                    grade: ''
                };
                
                semester.courses.push(course);
                this.renderCourse(semesterId, course);
                this.saveToStorage();
            }

            renderCourse(semesterId, course) {
                const container = document.getElementById(`courses-${semesterId}`);
                const courseDiv = document.createElement('div');
                courseDiv.className = 'course-row grid grid-cols-1 md:grid-cols-5 gap-2 items-center';
                courseDiv.id = `course-${course.id}`;
                
                courseDiv.innerHTML = `
                    <input type="text" placeholder="Course Code" value="${course.code}" 
                           class="p-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm dark:bg-gray-600 dark:text-white"
                           onchange="cgpaTracker.updateCourse(${course.id}, 'code', this.value)">
                    <input type="text" placeholder="Course Name" value="${course.name}" 
                           class="p-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm dark:bg-gray-600 dark:text-white"
                           onchange="cgpaTracker.updateCourse(${course.id}, 'name', this.value)">
                    <input type="number" placeholder="Credits" value="${course.credits}" min="1" max="6" 
                           class="p-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm dark:bg-gray-600 dark:text-white"
                           onchange="cgpaTracker.updateCourse(${course.id}, 'credits', this.value)">
                    <select onchange="cgpaTracker.updateCourse(${course.id}, 'grade', this.value)" 
                            class="p-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm dark:bg-gray-600 dark:text-white">
                        <option value="">Select Grade</option>
                        ${Object.keys(this.gradePoints).map(grade => 
                            `<option value="${grade}" ${course.grade === grade ? 'selected' : ''}>${grade}</option>`
                        ).join('')}
                    </select>
                    <button onclick="cgpaTracker.removeCourse(${semesterId}, ${course.id})" 
                            class="bg-red-500 text-white px-2 py-1 rounded-lg hover:bg-red-600 transition text-sm">
                        Remove
                    </button>
                `;
                
                container.appendChild(courseDiv);
            }

            updateCourse(courseId, field, value) {
                for (const semester of this.semesters) {
                    const course = semester.courses.find(c => c.id === courseId);
                    if (course) {
                        course[field] = field === 'credits' ? parseInt(value) || 0 : value;
                        this.updateSemesterStats(semester.id);
                        this.saveToStorage();
                        break;
                    }
                }
            }

            updateSemesterStats(semesterId) {
                const semester = this.semesters.find(s => s.id === semesterId);
                if (!semester) return;

                let totalPoints = 0;
                let totalCredits = 0;

                semester.courses.forEach(course => {
                    if (course.grade && course.credits > 0) {
                        totalPoints += this.gradePoints[course.grade] * course.credits;
                        totalCredits += course.credits;
                    }
                });

                const gpa = totalCredits > 0 ? (totalPoints / totalCredits).toFixed(2) : '0.00';
                
                document.getElementById(`semester-gpa-${semesterId}`).textContent = `GPA: ${gpa}`;
                document.getElementById(`semester-credits-${semesterId}`).textContent = `Credits: ${totalCredits}`;
            }

            removeCourse(semesterId, courseId) {
                const semester = this.semesters.find(s => s.id === semesterId);
                if (!semester) return;

                semester.courses = semester.courses.filter(c => c.id !== courseId);
                document.getElementById(`course-${courseId}`).remove();
                this.updateSemesterStats(semesterId);
                this.saveToStorage();
            }

            removeSemester(semesterId) {
                this.semesters = this.semesters.filter(s => s.id !== semesterId);
                document.getElementById(`semester-${semesterId}`).remove();
                this.updateSemesterNumbers();
                this.saveToStorage();
            }

            updateSemesterNumbers() {
                this.semesters.forEach((semester, index) => {
                    const semesterDiv = document.getElementById(`semester-${semester.id}`);
                    if (semesterDiv) {
                        semesterDiv.querySelector('h3').textContent = `Semester ${index + 1}`;
                    }
                });
            }

            calculateResults() {
                const studentId = document.getElementById('student-id').value;
                const studentName = document.getElementById('student-name').value;
                const batch = document.getElementById('batch').value;
                const department = document.getElementById('department').value;
                const targetCGPA = parseFloat(document.getElementById('target-cgpa').value) || 3.75;
                const remainingSemesters = parseInt(document.getElementById('remaining-semesters').value) || 3;

                // Validation
                if (!studentId || !studentName || !batch || !department) {
                    alert('Please fill in all student information fields.');
                    return;
                }

                if (this.semesters.length === 0) {
                    alert('Please add at least one semester with courses.');
                    return;
                }

                // Calculate overall statistics
                let totalPoints = 0;
                let totalCredits = 0;
                const semesterGPAs = [];

                this.semesters.forEach((semester, index) => {
                    let semesterPoints = 0;
                    let semesterCredits = 0;

                    semester.courses.forEach(course => {
                        if (course.grade && course.credits > 0) {
                            const points = this.gradePoints[course.grade] * course.credits;
                            semesterPoints += points;
                            semesterCredits += course.credits;
                            totalPoints += points;
                            totalCredits += course.credits;
                        }
                    });

                    const semesterGPA = semesterCredits > 0 ? semesterPoints / semesterCredits : 0;
                    semesterGPAs.push({
                        semester: index + 1,
                        gpa: semesterGPA,
                        credits: semesterCredits
                    });
                });

                const currentCGPA = totalCredits > 0 ? totalPoints / totalCredits : 0;
                
                // Calculate required GPA for target
                const avgCreditsPerSemester = totalCredits / this.semesters.length || 15;
                const requiredTotalPoints = targetCGPA * (totalCredits + remainingSemesters * avgCreditsPerSemester);
                const requiredFuturePoints = requiredTotalPoints - totalPoints;
                const requiredGPA = remainingSemesters > 0 ? requiredFuturePoints / (remainingSemesters * avgCreditsPerSemester) : 0;

                // Update quick stats
                document.getElementById('current-cgpa-display').textContent = currentCGPA.toFixed(2);
                document.getElementById('total-credits-display').textContent = totalCredits;
                document.getElementById('semesters-completed-display').textContent = this.semesters.length;

                // Display results
                this.displayResults(studentId, studentName, batch, department, currentCGPA, targetCGPA, requiredGPA, remainingSemesters, avgCreditsPerSemester);
                this.displaySemesterSummary(semesterGPAs);
                this.createChart(semesterGPAs, targetCGPA);

                // Save data
                this.saveToStorage();
            }

            displayResults(studentId, studentName, batch, department, currentCGPA, targetCGPA, requiredGPA, remainingSemesters, avgCredits) {
                const resultsCard = document.getElementById('results-card');
                const resultsContent = document.getElementById('results-content');
                
                const getGradeColor = (gpa) => {
                    if (gpa >= 3.7) return 'text-green-600';
                    if (gpa >= 3.0) return 'text-yellow-600';
                    if (gpa >= 2.7) return 'text-orange-600';
                    return 'text-red-600';
                };

                const getRequiredGradeAdvice = (required) => {
                    if (required > 4.0) return 'Target may be unachievable with current performance';
                    if (required >= 3.7) return 'Excellent performance required';
                    if (required >= 3.0) return 'Good performance required';
                    if (required >= 2.7) return 'Satisfactory performance required';
                    return 'Minimum performance required';
                };

                resultsContent.innerHTML = `
                    <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">
                        <h3 class="font-semibold text-blue-800 dark:text-blue-200 mb-2">Student Information</h3>
                        <div class="text-sm text-blue-700 dark:text-blue-300 space-y-1">
                            <p><strong>ID:</strong> ${studentId}</p>
                            <p><strong>Name:</strong> ${studentName}</p>
                            <p><strong>Batch:</strong> ${batch} | <strong>Department:</strong> ${department}</p>
                        </div>
                    </div>
                    
                    <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg">
                        <h3 class="font-semibold text-green-800 dark:text-green-200 mb-2">Current Performance</h3>
                        <div class="text-sm text-green-700 dark:text-green-300 space-y-1">
                            <p class="text-lg ${getGradeColor(currentCGPA)}"><strong>Current CGPA: ${currentCGPA.toFixed(2)}</strong></p>
                            <p>Total Credits Completed: ${document.getElementById('total-credits-display').textContent}</p>
                            <p>Semesters Completed: ${this.semesters.length}</p>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg">
                        <h3 class="font-semibold text-yellow-800 dark:text-yellow-200 mb-2">Target Analysis</h3>
                        <div class="text-sm text-yellow-700 dark:text-yellow-300 space-y-1">
                            <p><strong>Target CGPA:</strong> ${targetCGPA.toFixed(2)}</p>
                            <p><strong>Remaining Semesters:</strong> ${remainingSemesters}</p>
                            <p class="text-lg ${getGradeColor(requiredGPA)}"><strong>Required GPA per remaining semester: ${requiredGPA.toFixed(2)}</strong></p>
                            <p class="text-xs italic">${getRequiredGradeAdvice(requiredGPA)}</p>
                            <p class="text-xs">Assumes ~${avgCredits.toFixed(0)} credits per semester</p>
                        </div>
                    </div>
                `;
                
                resultsCard.classList.remove('hidden');
            }

            displaySemesterSummary(semesterGPAs) {
                const summaryCard = document.getElementById('semester-summary');
                const summaryContent = document.getElementById('semester-summary-content');
                
                summaryContent.innerHTML = semesterGPAs.map(sem => `
                    <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <span class="font-medium text-gray-800 dark:text-white">Semester ${sem.semester}</span>
                        <div class="text-right">
                            <span class="text-lg font-semibold text-primary">${sem.gpa.toFixed(2)}</span>
                            <span class="text-sm text-gray-500 dark:text-gray-400 ml-2">(${sem.credits} credits)</span>
                        </div>
                    </div>
                `).join('');
                
                summaryCard.classList.remove('hidden');
            }

            createChart(semesterGPAs, targetCGPA) {
                const chartCard = document.getElementById('chart-card');
                const ctx = document.getElementById('cgpa-chart').getContext('2d');
                
                if (this.chart) {
                    this.chart.destroy();
                }
                
                const cumulativeGPAs = [];
                let cumulativePoints = 0;
                let cumulativeCredits = 0;
                
                semesterGPAs.forEach(sem => {
                    cumulativePoints += sem.gpa * sem.credits;
                    cumulativeCredits += sem.credits;
                    cumulativeGPAs.push(cumulativeCredits > 0 ? cumulativePoints / cumulativeCredits : 0);
                });
                
                this.chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: semesterGPAs.map(sem => `Sem ${sem.semester}`),
                        datasets: [{
                            label: 'Semester GPA',
                            data: semesterGPAs.map(sem => sem.gpa),
                            borderColor: '#F59E0B',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            fill: true,
                            tension: 0.4
                        }, {
                            label: 'Cumulative CGPA',
                            data: cumulativeGPAs,
                            borderColor: '#1E40AF',
                            backgroundColor: 'rgba(30, 64, 175, 0.1)',
                            fill: false,
                            tension: 0.4
                        }, {
                            label: 'Target CGPA',
                            data: new Array(semesterGPAs.length).fill(targetCGPA),
                            borderColor: '#10B981',
                            backgroundColor: 'transparent',
                            borderDash: [5, 5],
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    color: document.documentElement.classList.contains('dark') ? '#E5E7EB' : '#374151'
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 4.0,
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#E5E7EB' : '#374151'
                                },
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#E5E7EB'
                                }
                            },
                            x: {
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#E5E7EB' : '#374151'
                                },
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#E5E7EB'
                                }
                            }
                        }
                    }
                });
                
                chartCard.classList.remove('hidden');
            }

            saveToStorage() {
                const data = {
                    studentInfo: {
                        id: document.getElementById('student-id').value,
                        name: document.getElementById('student-name').value,
                        batch: document.getElementById('batch').value,
                        department: document.getElementById('department').value
                    },
                    semesters: this.semesters,
                    targetCGPA: document.getElementById('target-cgpa').value,
                    remainingSemesters: document.getElementById('remaining-semesters').value,
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem('cgpaTrackerData', JSON.stringify(data));
            }

            loadFromStorage() {
                const savedData = localStorage.getItem('cgpaTrackerData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    
                    // Load student info
                    if (data.studentInfo) {
                        document.getElementById('student-id').value = data.studentInfo.id || '';
                        document.getElementById('student-name').value = data.studentInfo.name || '';
                        document.getElementById('batch').value = data.studentInfo.batch || '';
                        document.getElementById('department').value = data.studentInfo.department || '';
                    }
                    
                    // Load target settings
                    document.getElementById('target-cgpa').value = data.targetCGPA || 3.75;
                    document.getElementById('remaining-semesters').value = data.remainingSemesters || 3;
                    
                    // Load semesters
                    if (data.semesters && data.semesters.length > 0) {
                        this.semesters = data.semesters;
                        this.semesterCount = Math.max(...data.semesters.map(s => s.id));
                        data.semesters.forEach(semester => {
                            this.renderSemester(semester);
                            semester.courses.forEach(course => {
                                this.renderCourse(semester.id, course);
                            });
                            this.updateSemesterStats(semester.id);
                        });
                    }
                }
            }
        }

        // Global logout function
        function logout() {
            localStorage.removeItem('currentUser');
            localStorage.removeItem('cgpaTrackerData');
            window.location.href = 'welcome.html';
        }

        // Initialize the application
        const cgpaTracker = new CGPATracker();
    </script>
</body>
</html>
